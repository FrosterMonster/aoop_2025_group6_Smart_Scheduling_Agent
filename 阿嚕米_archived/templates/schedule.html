<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Smart Scheduler Pro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        :root { --primary-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); }
        body { background-color: #f4f7f6; }
        .hero-card { background: var(--primary-gradient); color: white; border: none; border-radius: 20px; box-shadow: 0 10px 20px rgba(37,117,252,0.2); }
        .form-card { border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); border: none; padding: 30px; }
        .btn-parse { background-color: #ffd700; color: #333; font-weight: bold; border: none; }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card hero-card p-4 mb-4 text-center">
                <h2>ğŸ“… AI æ™ºèƒ½å…¨æ—¥æ›†åŠ©æ‰‹</h2>
                <p class="opacity-75">è·¨æ—¥æ›†è¡çªåµæ¸¬ï¼Œè‡ªå‹•ç‚ºæ‚¨å°‹æ‰¾æœ€ä½³æ™‚æ®µ</p>
                <div class="input-group mt-3">
                    <input type="text" id="nl_input" class="form-control form-control-lg border-0" placeholder="ä¾‹å¦‚ï¼šæ˜å¤©æ‰¾æœ‰ç©ºçš„æ™‚é–“é‹å‹•ä¸€å°æ™‚...">
                    <button class="btn btn-parse px-4" onclick="processAI()" id="ai_btn">é–‹å§‹è§£æ</button>
                </div>
            </div>

            <div class="card form-card">
                {% if success %}
                <div class="alert alert-success">æˆåŠŸï¼å·²åŒæ­¥è‡³ Google æ—¥æ›†ã€‚</div>
                {% endif %}
                {% if error %}
                <div class="alert alert-danger">{{ error }}</div>
                {% endif %}

                <form action="/schedule" method="POST">
                    <input type="hidden" name="is_flexible" id="is_flexible_field" value="false">
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">æ´»å‹•äº‹é …</label>
                        <input type="text" name="summary" id="summary_field" class="form-control" required placeholder="ä¾‹å¦‚ï¼šæ…¢è·‘">
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">æ—¥æœŸ</label>
                            <input type="date" name="date" id="date_field" class="form-control">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">é–‹å§‹æ™‚é–“ (å›ºå®šè¡Œç¨‹)</label>
                            <input type="time" name="start_time" id="start_time_field" class="form-control">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">æŒçºŒæ™‚æ•¸</label>
                            <input type="number" step="0.5" name="hours" id="hours_field" class="form-control" value="1.0">
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">é‡è¤‡è¨­å®š</label>
                        <select name="recurrence" id="recurrence_field" class="form-select">
                            <option value="">ä¸€æ¬¡æ€§æ´»å‹•</option>
                            <option value="DAILY">æ¯å¤©é‡è¤‡</option>
                            <option value="WEEKLY">æ¯é€±é‡è¤‡</option>
                        </select>
                    </div>

                    <div id="ai_suggestion" class="alert alert-light border d-none"></div>
                    <button type="submit" class="btn btn-primary w-100 btn-lg shadow">ç¢ºèªæ–°å¢è‡³æ—¥æ›†</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
async function processAI() {
    const text = document.getElementById('nl_input').value;
    const btn = document.getElementById('ai_btn');
    if(!text) return;

    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';

    try {
        const response = await fetch('/api/parse_nl', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({text: text})
        });
        const data = await response.json();

        // å¡«å…¥è³‡æ–™
        document.getElementById('summary_field').value = data.title || "";
        document.getElementById('date_field').value = data.date || ""; 
        document.getElementById('hours_field').value = data.duration ? (data.duration/60).toFixed(1) : 1.0;
        document.getElementById('start_time_field').value = data.start_time || "";
        
        // åˆ¤æ–·å½ˆæ€§
        const isFlex = data.is_flexible || text.includes("æœ‰ç©º");
        document.getElementById('is_flexible_field').value = isFlex;
        
        const suggestion = document.getElementById('ai_suggestion');
        suggestion.classList.remove('d-none');
        suggestion.innerHTML = isFlex ? 
            "âœ¨ <b>AI å»ºè­°ï¼š</b> ç³»çµ±å°‡è‡ªå‹•é¿é–‹æ‚¨çš„ã€Œä¸Šèª²ã€ã€ã€Œå®¶æ•™ã€ç­‰æ‰€æœ‰æ—¥æ›†è¡çªï¼Œç‚ºæ‚¨æ‰¾å°‹ç©ºæª”ã€‚" : 
            "ğŸ“ <b>AI å»ºè­°ï¼š</b> æ­¤ç‚ºå›ºå®šè¡Œç¨‹ï¼Œå°‡æ’å®šæ–¼æŒ‡å®šæ™‚é–“ã€‚";

        if (data.is_recurring) document.getElementById('recurrence_field').value = "DAILY";

    } catch (e) {
        alert("è§£æå¤±æ•—");
    } finally {
        btn.disabled = false;
        btn.innerText = "é–‹å§‹è§£æ";
    }
}
</script>
</body>
</html>