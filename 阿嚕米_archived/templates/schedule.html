<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Smart Scheduler Pro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        :root { --primary-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); }
        body { background-color: #f0f2f5; }
        .hero-card { background: var(--primary-gradient); color: white; border: none; border-radius: 20px; }
        .form-card { border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border: none; }
        .ai-badge { background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 50px; font-size: 0.8rem; }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-7">
            <div class="card hero-card p-4 mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0">âœ¨ AI æ™ºèƒ½æ’ç¨‹</h3>
                    <span class="ai-badge">Gemini 2.0 Powered</span>
                </div>
                <div class="input-group shadow-sm">
                    <input type="text" id="nl_input" class="form-control form-control-lg border-0" placeholder="ä¾‹å¦‚ï¼šæ‰¾æœ‰ç©ºçš„æ™‚é–“å»ç¹³åœè»Šè²»...">
                    <button class="btn btn-warning px-4 fw-bold" onclick="processAI()" id="ai_btn">è§£ææŒ‡ä»¤</button>
                </div>
                <div class="mt-2 small opacity-75">ğŸ’¡ æç¤ºï¼šèªªã€Œæ¯å¤©æ™šä¸Šä¹é»ã€æˆ–ã€Œå¹«æˆ‘æ‰¾æœ‰ç©ºçš„æ™‚é–“ã€</div>
            </div>

            <div class="card form-card p-4">
                <form action="/schedule" method="POST">
                    <input type="hidden" name="is_flexible" id="is_flexible_field" value="false">
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">æ´»å‹•äº‹é …</label>
                        <input type="text" name="summary" id="summary_field" class="form-control form-control-lg" required>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">é è¨ˆé–‹å§‹æ™‚é–“ (å›ºå®šè¡Œç¨‹ç”¨)</label>
                            <input type="time" name="start_time" id="start_time_field" class="form-control">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">æŒçºŒæ™‚æ•¸ (å°æ™‚)</label>
                            <input type="number" step="0.5" name="hours" id="hours_field" class="form-control" value="1.0">
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">é€±æœŸæ€§</label>
                        <select name="recurrence" id="recurrence_field" class="form-select">
                            <option value="">ä¸€æ¬¡æ€§æ´»å‹•</option>
                            <option value="DAILY">æ¯å¤©é‡è¤‡åŸ·è¡Œ</option>
                            <option value="WEEKLY">æ¯é€±é‡è¤‡åŸ·è¡Œ</option>
                        </select>
                    </div>

                    <div id="ai_status" class="alert alert-info d-none mb-3">æ­£åœ¨æœå°‹æœ€ä½³ç©ºæª”...</div>
                    <button type="submit" class="btn btn-primary w-100 btn-lg shadow">ç¢ºèªæ–°å¢è‡³ Google æ—¥æ›†</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
async function processAI() {
    const text = document.getElementById('nl_input').value;
    const btn = document.getElementById('ai_btn');
    if(!text) return;

    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';

    try {
        const response = await fetch('/api/parse_nl', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({text: text})
        });
        const data = await response.json();

        // æ ¸å¿ƒå¡«å…¥é‚è¼¯
        document.getElementById('summary_field').value = data.title || "";
        document.getElementById('hours_field').value = data.duration ? (data.duration/60).toFixed(1) : 1.0;
        document.getElementById('start_time_field').value = data.start_time || "";
        
        // è¨­å®šå½ˆæ€§æ¨™ç±¤
        const isFlex = data.is_flexible || text.includes("æœ‰ç©º");
        document.getElementById('is_flexible_field').value = isFlex;
        document.getElementById('ai_status').className = isFlex ? "alert alert-success mt-2" : "alert alert-info mt-2";
        document.getElementById('ai_status').innerText = isFlex ? "âœ¨ AI å»ºè­°ï¼šæ­¤è¡Œç¨‹å°‡è‡ªå‹•æ‰¾å°‹ç©ºæª”æ’å…¥" : "ğŸ“ AI å»ºè­°ï¼šæ­¤è¡Œç¨‹å°‡æ’åœ¨æŒ‡å®šæ™‚é–“";
        document.getElementById('ai_status').classList.remove('d-none');

        // è™•ç†é‡è¤‡
        if (data.is_recurring) document.getElementById('recurrence_field').value = "DAILY";

    } catch (e) {
        alert("è§£æå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
    } finally {
        btn.disabled = false;
        btn.innerText = "è§£ææŒ‡ä»¤";
    }
}
</script>
</body>
</html>